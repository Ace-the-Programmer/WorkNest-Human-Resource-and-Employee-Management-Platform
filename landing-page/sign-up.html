<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Account - WorkNest</title>
    <link rel="stylesheet" href="sign-up.css">
</head>
<body>
    <!-- Back Button -->
    <a href="portal-selection.html" class="back-btn">
        <svg class="back-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        Back to Home
    </a>

    <div class="container">
        <div class="signup-card">
            <h1 class="title">Create Account</h1>
            <p class="subtitle">Join WorkNest and start managing your work</p>

            <form id="signupForm">
                <!-- Name Fields -->
                <div class="form-row">
                    <div class="form-group">
                        <label>First Name</label>
                        <input type="text" name="first_name" placeholder="Ace" required>
                    </div>
                    <div class="form-group">
                        <label>Last Name</label>
                        <input type="text" name="last_name" placeholder="Cumbe" required>
                    </div>
                </div>

                <!-- Email -->
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" name="email" placeholder="ace@example.com" required>
                </div>

                <!-- Password -->
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" name="password" placeholder="••••••••" required>
                </div>

                <!-- Account Type -->
                <div class="form-group">
                    <label>Account Type</label>
                    <div class="account-type-buttons">
                        <button type="button" class="account-type-btn active" data-type="HR/Admin">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
                            </svg>
                            <span>HR/Admin</span>
                        </button>
                        <button type="button" class="account-type-btn" data-type="Employee">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                <circle cx="12" cy="7" r="4"/>
                            </svg>
                            <span>Employee</span>
                        </button>
                    </div>
                </div>

                <!-- Department (only for Employee) -->
                <div class="form-group" id="departmentField" style="display: none;">
                    <label>Department</label>
                    <select name="department" required>
                        <option value="">Select your department</option>
                        <option value="1">Information Technology</option>
                        <option value="2">Human Resources</option>
                        <option value="3">Finance</option>
                        <option value="4">Marketing</option>
                        <option value="5">Operations</option>
                    </select>
                </div>

                <!-- Submit Button -->
                <button type="submit" class="submit-btn">Sign Up</button>

                <!-- Login Link -->
                <p class="login-link">
                    Already have an account? <a href="portal-selection.html">Log In</a>
                </p>
            </form>
        </div>
    </div>

    <script>
    // sign-up.js CODE (no need for separate file)
    const form = document.getElementById('signupForm');
    const accountTypeButtons = document.querySelectorAll('.account-type-btn');
    const departmentField = document.getElementById('departmentField');
    let selectedAccountType = 'HR/Admin'; // default

    // Handle account type selection
    accountTypeButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            // Remove active class from all
            accountTypeButtons.forEach(b => b.classList.remove('active'));
            // Add active to clicked
            btn.classList.add('active');
            selectedAccountType = btn.dataset.type;
            // Show/hide department field
            if (selectedAccountType.toLowerCase() === 'employee') {
                departmentField.style.display = 'block';
                form.department.setAttribute('required', 'required');
            } else {
                departmentField.style.display = 'none';
                form.department.removeAttribute('required');
            }
        });
    });

    // Handle form submission
    form.addEventListener('submit', (e) => {
        e.preventDefault();
        const formData = {
            first_name: form.first_name.value,
            last_name: form.last_name.value,
            email: form.email.value,
            password: form.password.value,
            account_type: selectedAccountType,
            department_id: selectedAccountType.toLowerCase() === 'employee' ? form.department.value : null
        };
        fetch('http://localhost:3000/signup', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formData)
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Account created successfully!');
                // Redirect based on role
                if (data.role === 'HR/Admin') {
                    window.location.href = '../admin-side/admin-dashboard.html';
                } else {
                    window.location.href = '../employee-side/employee-dashboard.html';
                }
            } else {
                alert('Failed to create account: ' + (data.error || 'Unknown error'));
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred during signup');
        });
    });

    // Trigger default logic
    document.querySelector('.account-type-btn.active').click();
    </script>
</body>
</html>
